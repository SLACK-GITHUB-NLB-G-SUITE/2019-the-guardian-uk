Up to 30 of the most hardline pro-Brexit Tories and 10 Democratic Unionist party MPs are still planning to vote against Theresa May’s deal, despite a string of Eurosceptics backing down when she promised to resign. May now faces an uphill battle to get her EU withdrawal agreement through parliament despite  promising to step down if her deal passes, which won her at least 20 Eurosceptic votes including those of Boris Johnson and Iain Duncan Smith. A source in the pro-Brexit European Research Group said 20 to 30 MPs were still holding out and there was “no way” the deal would get through. Arlene Foster, the leader of the Democratic Unionist party, said she “regrets” that it was unable to support the withdrawal agreement while it “poses a threat to the integrity of the UK”. A source said May had made a personal plea to Foster but the DUP would not budge. It means May is struggling to reach the magic number of 320 votes from MPs. At the moment, she only has around 270 publicly declared Tory, Labour and independent supporters for her withdrawal agreement. To pass the deal, she would most likely need votes from at least 303 out of 313 Conservative MPs and all 10 of the Democratic Unionist party MPs in addition to the seven Labour and independent MPs who have already backed her. Alternatively, she could get the deal through if there were a substantial number of switchers or abstentions on the Labour side. Duncan Smith, the former Conservative leader, was one of those to publicly back May’s deal before hearing from the DUP, along with Johnson, who said he would “reluctantly” support it despite repeated warnings in recent months that it would render the UK a “vassal state”. However, the most hardline Eurosceptics – nicknamed “the Spartans” – continued to rail against May’s deal at a meeting of the ERG, which is now bitterly divided. Steve Baker, a key figure in the bloc, gave an impassioned speech to fellow MPs saying he was “consumed with a ferocious rage after that pantomime”. “Like all of you I have wrestled with my conscience about what to do,” he said. “I could tear this place down and bulldoze it into the river. These fools and knaves and cowards are voting on things they don’t even understand. “We’ve been put in this place by people whose addiction to power without responsibility has led them to put the choice of no Brexit or this deal. I may yet resign the whip rather than be part of this.” An ERG source claimed that “no way the deal is getting out of the room” and estimated that residual opposition amounted to as many as 30 MPs, judging by those speaking and those who had made further statements on WhatsApp groups. But another source close to a senior ERG MP said the number was more like 12 to 15. Conservative MPs Andrew Bridgen and Andrea Jenkyns publicly said they would not be changing their minds and supporting May’s deal. At the same time, there are up to seven Tory MPs in favour of a second referendum who are refusing to vote for the deal. Unless more Eurosceptics fold, it is likely May would still need some more Labour backers but some MPs who had been considering supporting the government or abstaining are worried about the possibility it could now lead to an even more fervently pro-Brexit prime minister. With May’s deal on a knife-edge, the DUP released a statement saying it still could not support it after intensive talks with the government. It said: “The DUP and the government have had good discussions in recent days and some progress on domestic legislation has been made. All concerned recognise the need to ensure that as we leave the European Union the economic and constitutional integrity of the United Kingdom is maintained. “However, given the fact that the necessary changes we seek to the backstop have not been secured between the government and the European Union, and the remaining and ongoing strategic risk that Northern Ireland would be trapped in backstop arrangements at the end of the implementation period, we will not be supporting the government if they table a fresh meaningful vote.” The spokesman said the backstop had “the potential to create an internal trade border within the United Kingdom and would cut us off from our main internal market, being Great Britain”. He added: “The backstop, which we warned this government against from its first inception, poses an unacceptable threat to the integrity of the United Kingdom and will inevitably limit the United Kingdom’s ability to negotiate on the type of future relationship with the EU.” One informed DUP source said members would not forgive Johnson for his decision to vote for the withdrawal deal. “He has done nothing to enhance his reputation for being slippery,” the source said. Johnson told the party’s conference four months ago that May’s deal would mean Northern Ireland becoming “an economic semi-colony of the EU ... no Conservative British government could or should sign up to such arrangements”.